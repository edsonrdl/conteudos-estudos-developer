# üìö Guia Completo: Como Analisar e Otimizar Bundle Angular

## üéØ Objetivo

Identificar o que est√° deixando sua aplica√ß√£o Angular pesada e como otimizar o bundle para melhorar a performance.

---

## üìã PARTE 1: Instala√ß√£o e Prepara√ß√£o

### Passo 1: Instalar as Ferramentas de An√°lise

powershell

```powershell
# Instalar webpack-bundle-analyzer (an√°lise visual)
npm install --save-dev webpack-bundle-analyzer

# Instalar source-map-explorer (alternativa mais simples)
npm install --save-dev source-map-explorer
```

### Passo 2: Adicionar Scripts no package.json

Abra o arquivo `package.json` e adicione esses scripts:

json

```json
{
  "scripts": {
    "build": "ng build",
    "build:prod": "ng build --configuration production",
    "build:stats": "ng build --stats-json",
    "analyze": "ng build --stats-json && webpack-bundle-analyzer dist/NOME-DO-SEU-PROJETO/stats.json",
    "analyze:source": "ng build --source-map && source-map-explorer dist/NOME-DO-SEU-PROJETO/browser/main*.js",
    "analyze:all": "ng build --source-map && source-map-explorer dist/NOME-DO-SEU-PROJETO/browser/*.js"
  }
}
```

‚ö†Ô∏è **Importante**: Substitua `NOME-DO-SEU-PROJETO` pelo nome real do seu projeto (ex: `generic-interface`)

---

## üîç PARTE 2: Gerando o Build com Estat√≠sticas

### Passo 3: Build com Stats JSON

powershell

```powershell
# Gerar build com arquivo de estat√≠sticas
ng build --stats-json
```

**O que isso faz?**

- Compila sua aplica√ß√£o
- Gera um arquivo `stats.json` com informa√ß√µes detalhadas sobre o bundle
- Mostra um resumo no terminal

### Passo 4: Entender o Output do Terminal

Ap√≥s o build, voc√™ ver√° algo assim:

```
Initial chunk files   | Names         | Raw size | Transfer size
chunk-ARULHAH5.js     | -             | 172.64 KB | 50.50 kB  ‚Üê üî¥ GRANDE
main-ITFL6AMO.js      | main          | 111.36 KB | 12.87 kB  ‚Üê üî¥ GRANDE
chunk-DIAJC3RH.js     | -             | 89.98 KB  | 22.66 kB  ‚Üê üü° M√âDIO
styles-DFNBWTVF.css   | styles        | 70.21 KB  | 12.14 kB  ‚Üê üü° M√âDIO
polyfills-B6TNHZQ6.js | polyfills     | 34.58 KB  | 11.32 kB  ‚Üê üü¢ OK

                      | Initial total | 564.97 kB | 134.46 kB

Lazy chunk files      | Names              | Raw size
chunk-IQX5MRWQ.js     | to-do-component    | 657.32 kB  ‚Üê OK (lazy)
```

#### üìä Como Interpretar:

**Initial chunks** = Carregam IMEDIATAMENTE (impacta tempo de carregamento)

- üî¥ > 100 KB = PROBLEMA - precisa otimizar
- üü° 50-100 KB = ATEN√á√ÉO - pode melhorar
- üü¢ < 50 KB = BOM

**Lazy chunks** = Carregam SOB DEMANDA (n√£o √© problema cr√≠tico)

- Podem ser grandes sem afetar carregamento inicial

**Transfer size** = Tamanho real transferido (com compress√£o gzip)

- Esse √© o tamanho que o usu√°rio realmente baixa

---

## üó∫Ô∏è PARTE 3: Localizando o stats.json

### Passo 5: Encontrar o Arquivo stats.json

**Op√ß√£o A - PowerShell (Windows):**

powershell

```powershell
# Procurar o arquivo stats.json
Get-ChildItem -Path .\dist -Recurse -Filter "stats.json"
```

**Op√ß√£o B - Listar toda estrutura:**

powershell

```powershell
# Ver toda estrutura da pasta dist
ls dist -Recurse
```

**Op√ß√£o C - CMD (Windows):**

cmd

```cmd
dir dist /s /b | findstr stats.json
```

**Op√ß√£o D - Linux/Mac:**

bash

```bash
find ./dist -name "stats.json"
```

#### Resultado Esperado:

```
Diret√≥rio: C:\...\dist\generic-interface

Mode    LastWriteTime    Length  Name
----    -------------    ------  ----
-a----  02/10/2025       670071  stats.json  ‚Üê AQUI EST√Å!
```

O caminho completo ser√° algo como:

```
dist/generic-interface/stats.json
```

---

## üìä PARTE 4: An√°lise Visual Detalhada

### Passo 6: Executar o webpack-bundle-analyzer

**M√©todo 1 - Usando npm script (RECOMENDADO):**

powershell

```powershell
npm run analyze
```

**M√©todo 2 - Comando direto:**

powershell

```powershell
# Use o caminho que voc√™ encontrou no Passo 5
npx webpack-bundle-analyzer dist/generic-interface/stats.json
```

**O que acontece:**

1. Abre automaticamente no navegador ([http://127.0.0.1:8888](http://127.0.0.1:8888))
2. Mostra um **mapa de calor visual** interativo
3. Cada bloco representa um arquivo/m√≥dulo
4. Tamanho do bloco = tamanho do arquivo

### Passo 7: Interpretar o Mapa Visual

#### üé® Como Ler o Gr√°fico:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üì¶ main.js                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ   PrimeNG            ‚îÇ  ‚îÇ RxJS     ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ   (150 KB) üî¥        ‚îÇ  ‚îÇ (45 KB)  ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ @angular‚îÇ  ‚îÇ  Seu c√≥digo             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ (89 KB) ‚îÇ  ‚îÇ  (25 KB) üü¢             ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Cores:**

- üî¥ Vermelho/Laranja = M√≥dulos grandes (FOCAR AQUI)
- üü° Amarelo = M√©dio
- üü¢ Verde/Azul = Pequenos (OK)

#### üîç Intera√ß√µes:

- **Clique** em um bloco ‚Üí mostra detalhes
- **Scroll** ‚Üí zoom in/out
- **Hover** ‚Üí mostra tamanho exato
- **Pesquisar** ‚Üí use Ctrl+F no navegador

---

## üéØ PARTE 5: Identificando os Culpados

### Passo 8: Checklist de An√°lise

Procure por estes padr√µes no mapa visual:

#### ‚úÖ **O que procurar:**

1. **Bibliotecas grandes demais**

```
   üî¥ primeng ‚Üí 200+ KB
   üî¥ chart.js ‚Üí 150+ KB
   üî¥ moment.js ‚Üí 70+ KB (use date-fns)
```

2. **M√≥dulos duplicados**

```
   ‚ö†Ô∏è lodash aparece 2x
   ‚ö†Ô∏è rxjs aparece em m√∫ltiplos chunks
```

3. **Imports desnecess√°rios**

typescript

```typescript
   // ‚ùå RUIM - importa biblioteca inteira
   import * as _ from 'lodash';
   
   // ‚úÖ BOM - importa s√≥ o necess√°rio
   import { debounce } from 'lodash-es';
```

4. **CSS/Fonts grandes**

```
   üî¥ primeicons.woff ‚Üí 85 KB
   üî¥ theme.css ‚Üí 70 KB
```

### Passo 9: An√°lise Alternativa com Source Maps

Se o webpack-bundle-analyzer n√£o funcionar, use:

powershell

```powershell
npm run analyze:source
```

Isso abre uma visualiza√ß√£o similar, mas baseada em source maps.

---

## üõ†Ô∏è PARTE 6: An√°lise Manual (Backup)

### Passo 10: An√°lise R√°pida com PowerShell

Crie um arquivo `analyze-manual.ps1`:

powershell

```powershell
# Ver tamanho dos arquivos JS ordenados
Write-Host "`nüì¶ An√°lise de Bundle - Initial Chunks`n" -ForegroundColor Cyan

Get-ChildItem -Path ".\dist\*\browser" -Recurse -Filter "*.js" | 
  Where-Object { $_.Name -notlike "chunk-*lazy*" } |
  Select-Object Name, @{Name="SizeKB";Expression={[math]::Round($_.Length/1KB, 2)}} | 
  Sort-Object SizeKB -Descending | 
  ForEach-Object {
    $icon = if ($_.SizeKB -gt 100) { "üî¥" } elseif ($_.SizeKB -gt 50) { "üü°" } else { "üü¢" }
    Write-Host "$icon $($_.Name.PadRight(30)) $($_.SizeKB) KB"
  }

Write-Host "`nüìä Total:" -ForegroundColor Cyan
$total = (Get-ChildItem -Path ".\dist\*\browser" -Recurse -Filter "*.js" | 
  Where-Object { $_.Name -notlike "*lazy*" } | 
  Measure-Object -Property Length -Sum).Sum / 1KB
Write-Host "$([math]::Round($total, 2)) KB`n" -ForegroundColor Yellow
```

Execute:

powershell

```powershell
.\analyze-manual.ps1
```

---

## üìà PARTE 7: Relat√≥rio de An√°lise

### Passo 11: Documentar Achados

Crie um arquivo `BUNDLE-ANALYSIS.md`:

markdown

```markdown
# üìä An√°lise de Bundle - [Data]

## Situa√ß√£o Atual
- **Total Initial**: 564.97 KB
- **Budget**: 500 KB
- **Excedente**: 64.97 KB (13% acima)

## üî¥ Principais Culpados

### 1. chunk-ARULHAH5.js (172.64 KB)
- **Cont√©m**: PrimeNG components + themes
- **Problema**: Importando m√≥dulos n√£o utilizados
- **Solu√ß√£o**: Import seletivo
- **Redu√ß√£o esperada**: -80 KB

### 2. main-ITFL6AMO.js (111.36 KB)
- **Cont√©m**: Angular core + aplica√ß√£o
- **Problema**: Sem lazy loading
- **Solu√ß√£o**: Lazy load de rotas
- **Redu√ß√£o esperada**: -40 KB

### 3. styles-DFNBWTVF.css (70.21 KB)
- **Cont√©m**: PrimeNG themes + icons
- **Problema**: Tema completo sendo carregado
- **Solu√ß√£o**: CSS customizado
- **Redu√ß√£o esperada**: -30 KB

## üéØ Meta
- **Novo total esperado**: ~415 KB
- **Redu√ß√£o total**: ~150 KB (26%)
```

---

## üöÄ PARTE 8: Plano de Otimiza√ß√£o

### Passo 12: Prioriza√ß√£o

**ALTA PRIORIDADE (Impacto > 50 KB):**

1. ‚úÖ Lazy load de rotas principais
2. ‚úÖ Otimizar imports do PrimeNG
3. ‚úÖ Remover bibliotecas n√£o utilizadas

**M√âDIA PRIORIDADE (Impacto 20-50 KB):** 4. ‚ö†Ô∏è Otimizar CSS/themes 5. ‚ö†Ô∏è Code splitting adicional 6. ‚ö†Ô∏è Substituir bibliotecas pesadas

**BAIXA PRIORIDADE (Impacto < 20 KB):** 7. üîµ Minifica√ß√£o extra 8. üîµ Tree shaking manual 9. üîµ Compression avan√ßada

---

## üîÑ PARTE 9: Monitoramento Cont√≠nuo

### Passo 13: Automatizar An√°lise

Adicione no `package.json`:

json

```json
{
  "scripts": {
    "build:check": "npm run build:stats && node check-bundle-size.js"
  }
}
```

Crie `check-bundle-size.js`:

javascript

```javascript
const fs = require('fs');
const path = require('path');

const BUDGET_KB = 500;
const distPath = './dist/generic-interface/browser';

function getFileSize(filePath) {
  const stats = fs.statSync(filePath);
  return stats.size / 1024;
}

console.log('\nüîç Verificando Bundle Size...\n');

const files = fs.readdirSync(distPath);
let totalSize = 0;

files
  .filter(f => f.endsWith('.js') && !f.includes('lazy'))
  .forEach(file => {
    const size = getFileSize(path.join(distPath, file));
    totalSize += size;
    
    const icon = size > 100 ? 'üî¥' : size > 50 ? 'üü°' : 'üü¢';
    console.log(`${icon} ${file.padEnd(30)} ${size.toFixed(2)} KB`);
  });

console.log(`\nüìä Total: ${totalSize.toFixed(2)} KB`);
console.log(`üéØ Budget: ${BUDGET_KB} KB`);

if (totalSize > BUDGET_KB) {
  const excess = totalSize - BUDGET_KB;
  console.log(`\n‚ùå EXCEDEU o budget em ${excess.toFixed(2)} KB (${((excess/BUDGET_KB)*100).toFixed(1)}%)\n`);
  process.exit(1);
} else {
  const remaining = BUDGET_KB - totalSize;
  console.log(`\n‚úÖ Dentro do budget! Restam ${remaining.toFixed(2)} KB\n`);
}
```

Execute antes de cada commit:

bash

```bash
npm run build:check
```

---

## üìö PARTE 10: Comandos de Refer√™ncia R√°pida

### Passo 14: Cheat Sheet

powershell

```powershell
# === AN√ÅLISE ===
npm run analyze              # An√°lise visual completa
npm run analyze:source       # Source map explorer
npm run build:stats          # Build com estat√≠sticas

# === ENCONTRAR ARQUIVOS ===
Get-ChildItem -Path .\dist -Recurse -Filter "stats.json"
ls dist -Recurse

# === BUILD ===
ng build                     # Build padr√£o
ng build --configuration production  # Build produ√ß√£o
ng build --stats-json        # Com estat√≠sticas

# === VERIFICAR DEPEND√äNCIAS ===
npm list --depth=0           # Ver todas depend√™ncias
npx depcheck                 # Encontrar n√£o utilizadas
npx find-duplicate-dependencies  # Duplicatas
```

---

## ‚úÖ Checklist Final

Ap√≥s an√°lise, voc√™ deve saber:

- [ ]  Qual o tamanho atual do bundle
- [ ]  Quais s√£o os 3 maiores arquivos
- [ ]  Quais bibliotecas est√£o sendo usadas
- [ ]  Se h√° imports duplicados
- [ ]  Quais m√≥dulos podem ser lazy loaded
- [ ]  Qual a meta de redu√ß√£o
- [ ]  Plano de a√ß√£o priorizado

---

## üéØ Exemplo Pr√°tico Completo

powershell

```powershell
# 1. Preparar ambiente
npm install --save-dev webpack-bundle-analyzer source-map-explorer

# 2. Adicionar scripts no package.json (ver Passo 2)

# 3. Gerar an√°lise
npm run analyze

# 4. Aguardar navegador abrir (http://127.0.0.1:8888)

# 5. Identificar culpados no mapa visual
#    - Procure blocos vermelhos/laranjas grandes
#    - Anote bibliotecas > 100 KB

# 6. Documentar no BUNDLE-ANALYSIS.md

# 7. Implementar otimiza√ß√µes (ver guia de otimiza√ß√£o)

# 8. Verificar melhorias
npm run build:check

# 9. Repetir at√© atingir meta
```

---

## üìñ Resumo Executivo

**O que foi feito que funcionou:**

1. ‚úÖ Instalou `webpack-bundle-analyzer`
2. ‚úÖ Gerou build com `ng build --stats-json`
3. ‚úÖ Localizou `stats.json` em `dist/generic-interface/stats.json`
4. ‚úÖ Executou an√°lise com caminho correto
5. ‚úÖ Identificou que **chunk-ARULHAH5.js (172 KB)** √© o maior culpado
6. ‚úÖ Verificou que **to-do component (657 KB)** est√° lazy loaded (OK!)

**Pr√≥ximos passos:**

- Otimizar imports do PrimeNG
- Implementar lazy loading de rotas
- Reduzir CSS/themes